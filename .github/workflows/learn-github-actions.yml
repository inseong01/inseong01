name: Check work log

run-name: ${{github.repository}} is running

on:
  push:
    branches:
      - '**' # 모든 브랜치 적용

jobs:
  check-work-log-file:
    if: github.repository == 'inseong01/inseong01'
    runs-on: ubuntu-latest

    steps:
      - name: Run current-date-time@v1
        id: t1
        uses: Kaven-Universe/github-action-current-date-time@v1
        with:
          format: 'YYYY.MM.DD.'
          timezone-offset: -540

      - name: Setup current date
        run: |
          YEAR_SHORT=$(echo "${{ steps.t1.outputs.year }}" | cut -c3-4)
          MONTH=$(expr ${{ steps.t1.outputs.month }} + 0)
          DAY=$(expr ${{ steps.t1.outputs.day }} + 0)

          echo "YEAR_SHORT=$YEAR_SHORT" >> $GITHUB_ENV
          echo "MONTH=$MONTH" >> $GITHUB_ENV
          echo "DAY=$DAY" >> $GITHUB_ENV
          echo "$YEAR_SHORT.$MONTH.$DAY."

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Find work log txt file
        run: |
          FILE_PATH=$(find . -type f -name "작업일지.txt" | head -n 1)
          if [ -f "$FILE_PATH" ]; then
            echo "WORK_LOG_FILE=$FILE_PATH" >> $GITHUB_ENV
          else
            echo "Error: Could not find 작업일지.txt file."
            exit 1
          fi

      - name: Check work log
        run: |
          if ! grep -q "$YEAR_SHORT.$MONTH.$DAY." "$FILE_PATH"; then
            echo "$YEAR_SHORT.$MONTH.$DAY. work log was not written."
            exit 1
          fi
          echo "$YEAR_SHORT.$MONTH.$DAY. work log was written."
